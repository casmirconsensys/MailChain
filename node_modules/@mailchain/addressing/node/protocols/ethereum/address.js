'use strict';

var crypto = require('@mailchain/crypto');
var encoding = require('@mailchain/encoding');

/**
 * Derive the ethereum address corresponding to the {@link PublicKey}.
 *
 * @param publicKey must be with with {@link KindSECP256K1} curve
 * @throw if the provided key is on unsupported curve
 */
async function addressFromPublicKey(publicKey) {
    if (publicKey.curve !== crypto.KindSECP256K1) {
        throw new Error(`public key must be ${crypto.KindSECP256K1}`);
    }
    const { computeAddress } = await import('@ethersproject/transactions');
    return encoding.decodeHexZeroX(computeAddress(publicKey.bytes));
}

exports.addressFromPublicKey = addressFromPublicKey;
